// libreria a usar: https://openapi-ts.dev/openapi-fetch/
// Consume el openapi.json del echo server, para actualizar correr `npm run external:gen`
// Habria que ver tema de urls y eso

import createClient from "openapi-fetch";
import type { paths } from "./defs/manager.js"; // generated by openapi-typescript
import { env } from "../env.js";

export const managerService = createClient<paths>({
  baseUrl: env.API_SERVICE_MANAGER,
  headers: {
    Authorization: `Bearer ${env.API_KEY}`,
  },
  fetch: (req) => {
    return fetch(req);
  },
});

managerService.use({
  onResponse: async ({ response }) => {
    if (!response.ok) {
      const body = await response.json();
      return new Response(
        JSON.stringify({
          type: "manager-service",
          title: body.title,
          status: body.status,
          detail: body.detail,
          errors: body.errors,
        }),
        {
          status: response.status,
          headers: response.headers,
          statusText: response.statusText,
        }
      );
    }
  },
});
